{"version":3,"file":"static/js/remoteMiddleware.js","mappings":"2OAOM,SAAgBA,EACpBC,EACAC,EACAC,G,+HAEA,OAAIC,EAAAA,EAAAA,KACK,CAAC,EAAD,KAEHC,GAAOC,EAAAA,EAAAA,MACPC,EAA6C,QAA1BC,EAAAN,EAASO,yBAAiB,IAAAD,EAAAA,EAAI,CAAC,EAClDE,EAAQC,OAAOC,QAAQL,GAC1BM,QAAO,SAACL,GAAEA,EAAA,GAAe,OAANA,EAAA,EAAM,IACzBM,KAAI,SAACN,GAAW,OAANA,EAAA,EAAM,IAEbO,EAAUL,EAAMI,KAAI,SAAOE,GAAI,OAAAC,EAAAA,EAAAA,IAAAC,OAAA,qB,oEAC7BC,EAAgBH,EAAKI,QAAQ,YAAa,IAC5CC,EAAaF,EACbhB,IACFkB,EAAaC,KAAKH,GAAeC,QAAQ,KAAM,KAE3CG,EAAW,GAAAC,OAAGnB,EAAI,gBAAAmB,OAAeH,EAAU,YAAAG,OAAWH,EAAU,U,iBAGpE,O,sBAAA,IAAMI,EAAAA,EAAAA,GAAWF,I,OAEjB,OAFAf,EAAAkB,OAEO,CAAP,EAAOC,OAAO,GAAAH,OAAGL,EAAa,gB,yBAE9BlB,EAAI2B,IAAI,QAASC,GACjB5B,EAAI6B,MAAMC,UAAU,4B,iCAIP,GAAMC,QAAQC,IAAIlB,K,OAGnC,MAAO,CAAP,EAHiBmB,EAAAR,OACOb,OAAOsB,U","sources":["../node_modules/@segment/analytics-next/src/plugins/remote-middleware/index.ts"],"sourcesContent":["import { LegacySettings } from '../../browser'\nimport { Context } from '../../core/context'\nimport { isServer } from '../../core/environment'\nimport { loadScript } from '../../lib/load-script'\nimport { getNextIntegrationsURL } from '../../lib/parse-cdn'\nimport { MiddlewareFunction } from '../middleware'\n\nexport async function remoteMiddlewares(\n  ctx: Context,\n  settings: LegacySettings,\n  obfuscate?: boolean\n): Promise<MiddlewareFunction[]> {\n  if (isServer()) {\n    return []\n  }\n  const path = getNextIntegrationsURL()\n  const remoteMiddleware = settings.enabledMiddleware ?? {}\n  const names = Object.entries(remoteMiddleware)\n    .filter(([_, enabled]) => enabled)\n    .map(([name]) => name)\n\n  const scripts = names.map(async (name) => {\n    const nonNamespaced = name.replace('@segment/', '')\n    let bundleName = nonNamespaced\n    if (obfuscate) {\n      bundleName = btoa(nonNamespaced).replace(/=/g, '')\n    }\n    const fullPath = `${path}/middleware/${bundleName}/latest/${bundleName}.js.gz`\n\n    try {\n      await loadScript(fullPath)\n      // @ts-ignore\n      return window[`${nonNamespaced}Middleware`] as MiddlewareFunction\n    } catch (error: any) {\n      ctx.log('error', error)\n      ctx.stats.increment('failed_remote_middleware')\n    }\n  })\n\n  let middleware = await Promise.all(scripts)\n  middleware = middleware.filter(Boolean)\n\n  return middleware as MiddlewareFunction[]\n}\n"],"names":["remoteMiddlewares","ctx","settings","obfuscate","isServer","path","getNextIntegrationsURL","remoteMiddleware","_a","enabledMiddleware","names","Object","entries","filter","map","scripts","name","__awaiter","_this","nonNamespaced","replace","bundleName","btoa","fullPath","concat","loadScript","sent","window","log","error_1","stats","increment","Promise","all","_b","Boolean"],"sourceRoot":""}